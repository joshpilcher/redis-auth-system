<!DOCTYPE html>
<html lang="en">
{% raw %}
<!--
Purpose: Main layout template. Provides:
 - Global head (title, CSS/JS includes)
 - Navbar (only if logged in)
 - Flash messages
 - Blocks for content and extra scripts

Usage examples:
 - Extend this file:  {% extends "base.html" %}
 - Override title:    {% block title %}Page Title{% endblock %}
 - Override content:  {% block content %}...{% endblock %}
 - Extra scripts:     {% block scripts %}...{% endblock %}
-->
{% endraw %}

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Campsite Finder - {% block title %}Welcome{% endblock %}</title>

    <!-- Bootstrap + Font Awesome -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet"
        integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13U3PEv4rRW1hYpg=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />

    <!-- Basic styling (theme, cards, navbar, forms, password toggle) -->
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        .container-custom {
            max-width: 500px;
            margin: 50px auto;
        }

        .card {
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
            border: none;
        }

        .card-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #fff;
            border-radius: 15px 15px 0 0 !important;
            padding: 20px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            border-radius: 25px;
            padding: 10px 30px;
            transition: transform .3s;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, .4);
        }

        .form-control,
        .form-select {
            border-radius: 25px;
            padding: 10px 20px;
        }

        .alert {
            border-radius: 10px;
        }

        .navbar {
            background: #fff;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .navbar-brand {
            font-weight: bold;
            color: #764ba2 !important;
        }

        /* Password input with toggle button */
        .input-with-icon {
            position: relative;
        }

        .input-with-icon .form-control {
            padding-right: 3rem;
            border-radius: 25px;
        }

        .password-btn {
            position: absolute;
            top: 50%;
            right: 12px;
            transform: translateY(-50%);
            border: none;
            background: transparent;
            cursor: pointer;
            width: 36px;
            height: 36px;
        }

        .icon-20 {
            width: 1.35rem;
            height: 1.35rem;
            color: #adb5bd;   /* light grey default */
            opacity: 0.9;
            transition: transform 0.2s ease, color 0.2s ease, opacity 0.2s ease;
        }

        .password-btn:hover .icon-20,
        .password-btn:focus .icon-20 {
            transform: scale(1.2);
            color: #6c757d;   /* darker grey hover/focus */
            opacity: 1;
        }
    </style>

    {% block extra_head %}{% endblock %}
</head>

<body>
    <!-- Navbar shown only if user is logged in -->
    {% if session.email %}
    <nav class="navbar navbar-expand-lg navbar-light">
        <div class="container">
            <a class="navbar-brand" href="{{ url_for('dashboard') }}">
                <i class="fa-solid fa-campground"></i> Campsite Finder
            </a>
            <div class="ms-auto d-flex align-items-center">
                <span class="navbar-text me-3">
                    <i class="fa-solid fa-user"></i> {{ session.first_name }}
                    {% if session.is_admin %}
                    <small class="text-muted ms-2">(Admin)</small>
                    {% endif %}
                </span>
                <a href="{{ url_for('logout') }}" class="btn btn-outline-danger btn-sm">
                    <i class="fa-solid fa-right-from-bracket"></i> Logout
                </a>
            </div>
        </div>
    </nav>
    {% endif %}

    <!-- Flash messages + page content -->
    <div class="container container-custom">
        {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
        {% for category, message in messages %}
        <div class="alert alert-{{ category }} alert-dismissible fade show mt-3" role="alert">
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
        {% endfor %}
        {% endif %}
        {% endwith %}

        {% block content %}{% endblock %}
    </div>

    <!-- Password show/hide icons -->
    <svg xmlns="http://www.w3.org/2000/svg" style="display:none;">
        <symbol id="bi-eye" viewBox="0 0 16 16" stroke="currentColor" stroke-width="1.5">
            <path d="M1 8s3-5 7-5 7 5 7 5-3 5-7 5-7-5-7-5Z" />
            <circle cx="8" cy="8" r="3" />
        </symbol>
        <symbol id="bi-eye-slash" viewBox="0 0 16 16" stroke="currentColor" stroke-width="1.5">
            <path d="M1 8s3-5 7-5 7 5 7 5-3 5-7 5-7-5-7-5Z" />
            <circle cx="8" cy="8" r="3" />
            <line x1="2" y1="2" x2="14" y2="14" />
        </symbol>
    </svg>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Password toggle script -->
    <script>
    document.addEventListener('DOMContentLoaded', function () {
        function wireToggle(inputId, btnId, useId) {
            const input = document.getElementById(inputId);
            const btn = document.getElementById(btnId);
            const useEl = document.getElementById(useId);
            if (!input || !btn || !useEl) return;

            // Initialise tooltip (hover only)
            let tooltip = new bootstrap.Tooltip(btn, { trigger: 'hover', title: 'Show password' });

            btn.addEventListener('click', function () {
                const isHidden = input.type === 'password';
                input.type = isHidden ? 'text' : 'password';

                // Switch icon
                useEl.setAttribute('href', isHidden ? '#bi-eye' : '#bi-eye-slash');

                // Update tooltip + aria-label dynamically
                const label = isHidden ? 'Hide password' : 'Show password';
                btn.setAttribute('aria-label', label);
                btn.setAttribute('data-bs-original-title', label);

                // Reset tooltip with new text
                tooltip.dispose();
                tooltip = new bootstrap.Tooltip(btn, { trigger: 'hover', title: label });
            });
        }

        wireToggle('password', 'togglePassword', 'togglePasswordIconUse');
        wireToggle('confirm_password', 'toggleConfirm', 'toggleConfirmIconUse');
    });
    </script>

    {% block scripts %}{% endblock %}
</body>

</html>